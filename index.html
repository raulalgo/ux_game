<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Press the button</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script type="text/javascript" src="jquery-3.1.1.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
        clicked=false;

        dos_flag=true;
        tres_flag = true;

        toggler = true;

        dos_counter = 0;

        levels = ["tres", "cuatro"];
        level_index = 0;
        present(levels[level_index]);
        $(".transition_wrapper").hide();
        $(".main").click(function(){
          console.log("clicked: " + clicked);
          class_arr = $(this).attr("class").split(" ");
          console.log("array: " + class_arr);
          console.log("esta en el array: " + jQuery.inArray("tres", class_arr));
          if(!clicked)
          {
            console.log("poh queh");

            //console.log(class_arr);
            if(jQuery.inArray("uno",class_arr)>=0)
            {
              clicked=true;
              winner=giveWinner(0,4);
              $(".box:eq("+winner+")").addClass("exit");
              $(".exit").click(function (e){
                exit(e);
                $("#uno").slideUp(100)

                clicked=false;
              });
            }
            else if(jQuery.inArray("dos", class_arr)>=0)
            {
              if(dos_flag)
              {
                winner = giveWinner(1,4);
                dos_flag = false;
              }

              console.log(winner);
              //Turning the current off
              $(".white").toggleClass("grey white clickme");

              $(".exit").toggleClass("grey exit");


              $("#dos .box:eq("+ dos_counter + ")").toggleClass("grey");

              if(dos_counter!=winner)
              {
                $("#dos .box:eq("+ dos_counter +")").toggleClass("white clickme");
              }
              else {
                $("#dos .box:eq("+ dos_counter + ")").toggleClass("exit");
              }
              dos_counter++;
              if(dos_counter==4)
                dos_counter=0;

              $(".exit").click(function (e){
                exit(e);
                $("#dos").slideUp(100);
                clicked="false";
              });
            }
            else if(jQuery.inArray("tres", class_arr)>=0)
            {
              console.log("click");
              if(tres_flag)
              {
                winner = giveWinner(0,4);
                for(i=0;i<4;i++)
                {
                  if (i==winner) {
                    $("#tres .box:eq(" + i + ")").addClass("winner")
                  }
                  else {
                    $("#tres .box:eq(" + i + ")").addClass("loser")
                  }
                }

                $(".loser").click(function (){
                  $(this).toggleClass("white grey")
                });

                $(".winner").click(function (e){
                  /*if(jQuery.inArray("exit", class_arr)==0)
                  {*/
                    $(this).removeClass("white winner");
                    $(this).addClass("exit");
                  //}
                  /*else {
                    exit(e);
                    $("#tres").slideUp(100);
                    clicked="false";
                  }*/
                })

                /*$(".exit").click(function (e){
                  exit(e);
                  $("#tres").slideUp(100);
                  clicked="false";
                });*/
              }

              if (toggler)
              {
                $("#tres .box").removeClass("grey");
                $("#tres .box").addClass("white clickme");
                toggler = false
              }
              else
              {
                $("#tres .box").addClass("grey");
                $("#tres .box").removeClass("white clickme");
                toggler = true
              }


            }
          }

        });

        function exit (e){
          console.log(e.pageX)
          $(".transition_wrapper").show();
          $(".transition_wrapper").addClass("fadeOut").delay(100);
          $(".transition_wrapper").delay(2000).queue(function (next){
                $(this).removeClass("fadeOut");
                $(this).hide();
                next();
            });

          $(".transitioner").css({"left": (e.pageX-50), "top":(e.pageY-50)});
          $(".transitioner").addClass("ripple");
          $(".transitioner").delay(2000).queue(function (next){
              $(this).removeClass("ripple");

              console.log("level index is: " + level_index);
              present(levels[++level_index])
              console.log("and now is: " + level_index);
              next();
            });
          /*$("html, body").stop(true,true).delay(400).animate({
            scrollTop: $("#dos").offset().top
          }, 400);*/
          /*$(".game").stop(true,true).delay(1000).animate({
            top: "-=100"
          }, 1000);*/
        }

        function giveWinner (from,to) {
          range = to-from;
          return Math.floor(Math.random()*range) + from;
        }

        function present (level){
          present_counter = 0
          console.log("presenting level:" +level);

            //console.log($("#" + level + " .box"))
            $("#"+level+" .box").each(function (index){

              $(this).delay(index * 50).queue(function (){
                $(this).toggleClass("hide fall");
              });
              present_counter++;
            })
            $("#"+level+" .button").delay(present_counter*50).queue(function (){
              $(this).toggleClass("hide fall");
            });
          /*else {
            level_index++
            if(levels[level_index]!=null)
              present(levels[level_index]);
          }*/
        }

        /*function win () {
          console.log("bien!");

        }*/

      })
    </script>
  </head>
  <body>
    <div class="transition_wrapper">
      <div class="transitioner"></div>
    </div>

      <ul class="game">
      <!--  <li id="uno">
            <div class="main_wrapper">
              <div class="box vertical fleft b_side hide">&nbsp;</div>
              <div class="box vertical fleft b_side hide">&nbsp;</div>
              <div class="box vertical fleft b_side hide">&nbsp;</div>
              <div class="box vertical fleft b_side hide">&nbsp;</div>
              <div class="clear"></div>
            </div>
            <div class="button blue main horizontal uno hide" id="boton">&nbsp;</div>
        </li>
        <li id="dos">
          <div class="main_wrapper">
            <div class="box grey horizontal b_center hide"></div>
            <div class="box grey horizontal b_center hide"></div>
            <div class="box grey horizontal b_center hide"></div>
            <div class="box grey horizontal b_center hide"></div>
          </div>
          <div class="button blue main horizontal dos hide">&nbsp;</div>
        </li>-->
        <li id="tres">
          <div class="main_wrapper">
            <div class="box grey horizontal b_center hide"></div>
            <div class="box grey horizontal b_center hide"></div>
            <div class="box grey horizontal b_center hide"></div>
            <div class="box grey horizontal b_center hide"></div>
          </div>
          <div class="button blue main horizontal tres hide">&nbsp;</div>
        </li>
      </ul>

  </body>
</html>
