<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Press the button</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script type="text/javascript" src="jquery-3.1.1.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
        clicked=false;

        dos_flag=true;
        dos_counter = 0;

        levels = ["uno", "dos", "tres"];
        level_index = 0;
        present(levels[level_index]);
        $(".transition_wrapper").hide();
        $(".main").click(function(){
          if(!clicked)
          {
            class_arr = $(this).attr("class").split(" ");
            //console.log(class_arr);
            if(jQuery.inArray("uno",class_arr)>=0)
            {
              clicked=true;
              winner=giveWinner(0,4);
              $(".box:eq("+winner+")").addClass("exit");
              $(".exit").click(function (e){
                exit(e);
                $("#uno").slideUp(100)

                clicked=false;
              });
            }
            else if(jQuery.inArray("dos", class_arr)>=0)
            {
              console.log("the level is:" +level_index);
              if(dos_flag)
              {
                winner = giveWinner(1,4);
                dos_flag = false;
              }

              console.log(winner);
              //Turning the current off
              $(".white").toggleClass("grey white clickme");

              $(".exit").toggleClass("grey exit");


              $("#dos .box:eq("+ dos_counter + ")").toggleClass("grey");

              if(dos_counter!=winner)
              {
                $("#dos .box:eq("+ dos_counter +")").toggleClass("white clickme");
              }
              else {
                $("#dos .box:eq("+ dos_counter + ")").toggleClass("exit");
              }
              dos_counter++;
              if(dos_counter==4)
                dos_counter=0;

              $(".exit").click(function (e){
                exit(e);
                $("#dos").slideUp(100);
                clicked="false";
              });
            }
          }

        });

        function exit (e){
          console.log(e.pageX)
          $(".transition_wrapper").show();
          $(".transition_wrapper").addClass("fadeOut").delay(100);
          $(".transition_wrapper").delay(2000).queue(function (next){
                $(this).removeClass("fadeOut");
                $(this).hide();
                //next();
            });

          $(".transitioner").css({"left": (e.pageX-50), "top":(e.pageY-50)});
          $(".transitioner").addClass("ripple");
          $(".transitioner").delay(2000).queue(function (next){
              $(this).removeClass("ripple");
              //next();
              present(levels[++level_index])
            });
          /*$("html, body").stop(true,true).delay(400).animate({
            scrollTop: $("#dos").offset().top
          }, 400);*/
          /*$(".game").stop(true,true).delay(1000).animate({
            top: "-=100"
          }, 1000);*/
        }

        function giveWinner (from,to) {
          range = to-from;
          return Math.floor(Math.random()*range) + from;
        }

        function present (level){
          present_counter = 0
          console.log(level);
          //console.log($("#" + level + " .box"))
          $("#"+level+" .box").each(function (index){

            $(this).delay(index * 50).queue(function (){
              $(this).toggleClass("hide fall");
            });
            present_counter++;
          })
          $("#"+level+" .button").delay(present_counter*50).queue(function (){
            $(this).toggleClass("hide fall");
          });
        }

        /*function win () {
          console.log("bien!");

        }*/

      })
    </script>
  </head>
  <body>
    <div class="transition_wrapper">
      <div class="transitioner"></div>
    </div>

      <ul class="game">
        <li id="uno" class=stage>
          <div class="main_wrapper">
            <div class="box vertical fleft b_side hide">&nbsp;</div>
            <div class="box vertical fleft b_side hide">&nbsp;</div>
            <div class="box vertical fleft b_side hide">&nbsp;</div>
            <div class="box vertical fleft b_side hide">&nbsp;</div>
            <div class="clear"></div>
          </div>
          <div class="button blue main horizontal uno hide" id="boton">&nbsp;</div>
        </li class=stage>
        <li id="dos" class="">
          <div class="main_wrapper">
            <div class="box grey horizontal b_center hide"></div>
            <div class="box grey horizontal b_center hide"></div>
            <div class="box grey horizontal b_center hide"></div>
            <div class="box grey horizontal b_center hide"></div>
          </div>
          <div class="button blue main horizontal dos hide">&nbsp;</div>
        </li>
        <li id="tres">
          <div class="main_wrapper"></div>
          <div class="button blue main horizontal tres">&nbsp;</div>
        </li>
      </ul>

  </body>
</html>
